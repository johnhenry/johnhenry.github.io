---
import { SITE_LIB_URL } from '../SETTINGS.mjs';
const properties = Astro.props;
properties.storageKey = properties['storage-key'];
const {
  global = 'cycleBodyClass',
  storageKey="",
  classes=[],
  parent="window",
  selector="body" } = properties;
if(!storageKey){
  throw new Error('storageKey is required');
}
---
<script type="module" define:vars={{SITE_LIB_URL, storageKey, classes, selector, global}}>
const localStorageCycler = await import(`${SITE_LIB_URL}js/localstorage-cycler/0.0.0/index.mjs`).then(m => m.default);
  const key = `${storageKey}`;
  const values = classes;
  const target = globalThis.document.querySelector(`${selector}`);
  const emit = ({value, key, index}) => {
    target.classList.remove(...values.filter(s=>s));
    if(value){
      target.classList.add(value);
    }
  }
  globalThis[global] = localStorageCycler(key, emit, ...values);
</script>